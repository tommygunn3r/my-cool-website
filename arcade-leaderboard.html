<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arcade Leaderboards - Gunner's Games</title>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #000; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; color: white; min-height: 100vh; padding: 20px; overflow-x: hidden; position: relative; }

        /* Grid + neon background */
        .parallax-container { position: fixed; top:0; left:0; width:100%; height:100%; z-index:0; pointer-events:none; }
        .parallax-layer { position:absolute; width:100%; height:100%; }
        .layer-1 { background: linear-gradient(0deg, transparent 24%, rgba(233,69,96,0.05) 25%, rgba(233,69,96,0.05) 26%, transparent 27%, transparent 74%, rgba(233,69,96,0.05) 75%, rgba(233,69,96,0.05) 76%, transparent 77%, transparent),
                          linear-gradient(90deg, transparent 24%, rgba(233,69,96,0.05) 25%, rgba(233,69,96,0.05) 26%, transparent 27%, transparent 74%, rgba(233,69,96,0.05) 75%, rgba(233,69,96,0.05) 76%, transparent 77%, transparent);
                    background-size: 50px 50px; animation: gridMove 20s linear infinite; }
        @keyframes gridMove { 0% { transform:translateY(0);} 100% { transform:translateY(50px);} }

        .layer-2 { background-image:
            radial-gradient(circle at 20% 30%, rgba(233,69,96,0.15) 0%, transparent 50%),
            radial-gradient(circle at 80% 70%, rgba(255,215,0,0.1) 0%, transparent 50%),
            radial-gradient(circle at 50% 50%, rgba(233,69,96,0.08) 0%, transparent 50%);
            animation: floatParticles 15s ease-in-out infinite;
        }
        @keyframes floatParticles { 0%,100% { transform:translate(0,0);} 50% { transform:translate(30px,-20px);} }

        /* Page structure */
        .container { max-width: 1400px; margin: 0 auto; position: relative; z-index: 1; }
        h1 { text-align:center; font-size:48px; margin:30px 0; text-shadow:0 0 15px #e94560; letter-spacing: 2px; }

        /* Leaderboard cards */
        .leaderboards-grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(280px, 1fr)); gap:20px; }
        .leaderboard { background:rgba(10,10,10,0.9); border:2px solid #1a1a1a; border-radius:12px; padding:15px; }
        .leaderboard-header { text-align:center; font-size:20px; color:#e94560; margin-bottom:12px; font-weight:bold; }

        .score-entry { display:flex; justify-content:space-between; align-items:center;
                       padding:8px 10px; margin-bottom:6px;
                       background:rgba(255,255,255,0.05);
                       border:1px solid rgba(255,255,255,0.08);
                       border-radius:6px; }

        .rank { font-size:18px; width:30px; text-align:center; font-weight:bold; }
        .rank.gold { color:#FFD700; }
        .rank.silver { color:#C0C0C0; }
        .rank.bronze { color:#CD7F32; }

        .player-name { font-size:14px; flex:1; padding-left:8px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
        .score-value { font-size:16px; font-weight:bold; color:#4CAF50; }

        .loading { text-align:center; padding:40px; font-size:20px; color:#aaa; }

        .fixed-nav { position:fixed; bottom:20px; right:20px; display:flex; gap:15px; z-index:1000; }
        .nav-button { padding:12px 20px; background:rgba(10,10,10,0.9); border:2px solid #e94560;
                      border-radius:10px; color:white; text-decoration:none; font-weight:bold;
                      transition:0.2s ease; }
        .nav-button:hover { background:rgba(233,69,96,0.15); }
    </style>
</head>

<body>
    <div class="parallax-container">
        <div class="parallax-layer layer-1"></div>
        <div class="parallax-layer layer-2"></div>
    </div>

    <div class="container">
        <h1>üïπÔ∏è GAME HIGH SCORES üïπÔ∏è</h1>

        <div class="leaderboards-grid" id="leaderboards">
            <div class="loading">Loading‚Ä¶</div>
        </div>
    </div>

    <div class="fixed-nav">
        <a href="arcade.html" class="nav-button">‚Üê Back to Arcade</a>
        <a href="index.html" class="nav-button">üè† Home</a>
    </div>

    <script type="module">
        import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

        const supabase = createClient(
            "https://pknhslxhpohrzgsfkisr.supabase.co",
            "sb_publishable_-zZw-pi_3q1sdNGhITKuhQ_ECyDARzc"
        );

        /* Games to show */
        const games = [
            { id: 'shooter', name: 'Space Shooter' },
            { id: 'square-man', name: 'Square Man' },
            { id: 'squario', name: 'Squario' },
            { id: 'squartris', name: 'Squartris' },
            { id: 'word_slider', name: 'Word Slider' },
            { id: 'wordrush', name: 'Word Rush' },
            { id: 'squogger', name: 'Squogger' },
            { id: 'square-kong', name: 'Square Kong' },
            { id: 'square-invaders', name: 'Square Invaders' },
            { id: 'squarepede', name: 'Squarepede' },
            { id: 'squarebreaker', name: 'Squarebreaker' }
        ];

        function rankClass(i){
            if(i===0) return "gold";
            if(i===1) return "silver";
            if(i===2) return "bronze";
            return "";
        }

        async function loadGameScores(gameId){
            const { data, error } = await supabase
                .from("game_highscores")
                .select("score, player_name, user_id, created_at")
                .eq("game_id", gameId)
                .order("score", { ascending:false })
                .limit(3);

            if(error){
                console.error("Leaderboard error:", error);
                return [];
            }
            return data;
        }

        async function buildLeaderboards(){
            const container = document.getElementById("leaderboards");
            container.innerHTML = "";

            for(const game of games){
                const scores = await loadGameScores(game.id);

                let html = `
                <div class="leaderboard">
                    <div class="leaderboard-header">${game.name}</div>
                `;

                if(scores.length === 0){
                    html += `<div class="loading">No scores yet</div>`;
                } else {
                    scores.forEach((entry, i)=>{
                        const displayName = entry.player_name || (entry.user_id ? `Player ${entry.user_id.substring(0, 8)}` : "Anonymous");
                        html += `
                        <div class="score-entry">
                            <div class="rank ${rankClass(i)}">#${i+1}</div>
                            <div class="player-name">${displayName}</div>
                            <div class="score-value">${entry.score}</div>
                        </div>
                        `;
                    });
                }

                html += `</div>`;
                container.innerHTML += html;
            }
        }

        buildLeaderboards();
    </script>

</body>
</html>
