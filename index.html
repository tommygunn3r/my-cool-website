<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Gunner's Games</title>

<style>
/* === GLOBAL RESET === */
* { margin:0; padding:0; box-sizing:border-box; }
html, body {
    width:100%;
    min-height:100vh;
    background:#000 !important;
    color:white;
    font-family:Arial, sans-serif;
    overflow-x:hidden;
}

/* HEADER */
header {
    background: transparent;
    padding: 20px 20px;
    text-align: center;
    border-bottom:3px solid #e94560;
}

.banner {
    max-width: 60%;
    margin: 0 auto;
}

.banner img {
    width:100%;
    max-width: 600px;
    height:auto;
    object-fit: contain;
}

/* MAIN CONTAINER */
main {
    width:100%;
    max-width:1200px;
    margin:auto;
    padding: 40px 20px;
    min-height: calc(100vh - 200px);
    display: flex;
    align-items: center;
    justify-content: center;
}

/* DESKTOP GRID LAYOUT */
.game-categories {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 20px;
    width: 100%;
}

.game-card {
    position: relative;
    border-radius: 15px;
    border: 3px solid #222;
    overflow: hidden;
    cursor: pointer;
    transition: all 0.3s ease;
    background: linear-gradient(135deg, #1a1a1a 0%, #0a0a0a 100%);
    box-shadow: 0 4px 15px rgba(0,0,0,0.5);
}

.game-card:hover {
    border-color: #e94560;
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(233, 69, 96, 0.4);
}

.game-card.disabled {
    opacity: 0.4;
    pointer-events: none;
    filter: grayscale(100%);
}

.game-image {
    position: relative;
    width: 100%;
    padding-bottom: 100%; /* Square aspect ratio */
    overflow: hidden;
    background: #000;
}

.game-image img {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: contain;
    transition: transform 0.3s ease;
}

.game-card:hover .game-image img {
    transform: scale(1.1);
}

/* MOBILE CAROUSEL LAYOUT */
@media (max-width: 767px) {
    .banner {
        max-width: 90%;
    }

    main {
        padding: 20px 0;
        min-height: calc(100vh - 180px);
    }

    .game-categories {
        display: flex;
        flex-direction: column;
        gap: 0;
        position: relative;
        width: 100%;
        height: 450px;
        perspective: 1000px;
        overflow: visible;
    }

    .game-card {
        position: absolute;
        left: 50%;
        top: 50%;
        width: 280px;
        height: 350px;
        margin-left: -140px;
        margin-top: -175px;
        transition: all 0.5s cubic-bezier(0.4, 0.0, 0.2, 1);
        transform-style: preserve-3d;
        opacity: 0;
        pointer-events: none;
        border-width: 2px;
    }

    .game-card.active {
        opacity: 1;
        pointer-events: auto;
        z-index: 10;
        transform: translateX(0) scale(1) rotateY(0deg);
        box-shadow: 0 10px 40px rgba(233, 69, 96, 0.3);
    }

    .game-card.prev {
        opacity: 0.5;
        transform: translateX(-180px) scale(0.8) rotateY(25deg);
        z-index: 5;
    }

    .game-card.next {
        opacity: 0.5;
        transform: translateX(180px) scale(0.8) rotateY(-25deg);
        z-index: 5;
    }

    .game-image {
        padding-bottom: 85%;
    }

    /* Navigation Arrows */
    .carousel-arrow {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: rgba(233, 69, 96, 0.2);
        border: 2px solid #e94560;
        color: #e94560;
        font-size: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: 20;
        transition: all 0.3s ease;
        user-select: none;
        -webkit-tap-highlight-color: transparent;
    }

    .carousel-arrow:active {
        transform: translateY(-50%) scale(0.9);
        background: rgba(233, 69, 96, 0.4);
    }

    .carousel-arrow.left {
        left: 10px;
    }

    .carousel-arrow.right {
        right: 10px;
    }

    /* Carousel Indicator Dots */
    .carousel-indicators {
        position: absolute;
        bottom: -40px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 10px;
        z-index: 20;
    }

    .carousel-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: #333;
        border: 2px solid #555;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .carousel-dot.active {
        background: #e94560;
        border-color: #e94560;
        transform: scale(1.3);
    }
}

/* TABLET LAYOUT */
@media (min-width: 768px) and (max-width: 1023px) {
    .game-categories {
        grid-template-columns: repeat(3, 1fr);
        gap: 25px;
    }

    .game-card {
        border-width: 3px;
    }
}

/* HIDE CAROUSEL CONTROLS ON DESKTOP */
@media (min-width: 768px) {
    .carousel-arrow,
    .carousel-indicators {
        display: none !important;
    }
}

/* FOOTER */
footer {
    padding: 20px;
    border-top: 3px solid #e94560;
    text-align: center;
    background: #000;
}

footer a {
    color: #aaa;
    text-decoration: none;
    margin: 0 10px;
    font-size: 14px;
    transition: color 0.3s ease;
}

footer a:hover {
    color: #e94560;
}

@media (max-width: 767px) {
    footer {
        margin-top: 60px;
        padding: 15px;
    }

    footer a {
        display: inline-block;
        margin: 5px 8px;
        font-size: 12px;
    }
}
</style>
</head>

<body>

<!-- GLOBAL PLAYER BAR (now contains all MODALS) -->
<div id="playerbar"></div>

<!-- HEADER -->
<header>
    <div class="banner">
        <img src="assets/banner.png">
    </div>
</header>

<!-- MAIN GAME GRID -->
<main id="gameContainer">
    <div class="game-categories" id="gameCategories">

        <div class="game-card" data-game="arcade.html" data-index="0">
            <div class="game-image"><img src="assets/arcade.png" alt="Arcade Games"></div>
        </div>

        <div class="game-card" data-game="casino.html" data-index="1">
            <div class="game-image"><img src="assets/casino.png" alt="Casino Games"></div>
        </div>

        <div class="game-card" data-game="solitaire.html" data-index="2">
            <div class="game-image"><img src="assets/solitaire.png" alt="Solitaire Games"></div>
        </div>

        <div class="game-card" data-game="multiplayer.html" data-index="3">
            <div class="game-image"><img src="assets/multiplayer.png" alt="Multiplayer Games"></div>
        </div>

        <div class="game-card" data-game="pool-hall.html" data-index="4">
            <div class="game-image"><img src="assets/pool-hall.png" alt="Pool Games"></div>
        </div>

        <div class="game-card" data-game="board-games.html" data-index="5">
            <div class="game-image"><img src="assets/board-games.png" alt="Board Games"></div>
        </div>

        <!-- Mobile Navigation Arrows (hidden on desktop) -->
        <div class="carousel-arrow left" id="prevBtn">‹</div>
        <div class="carousel-arrow right" id="nextBtn">›</div>

        <!-- Carousel Indicators -->
        <div class="carousel-indicators" id="carouselIndicators"></div>

    </div>
</main>

<!-- FOOTER -->
<footer>
    <a href="about.html">About</a>
    <a href="contact.html">Contact</a>
    <a href="privacy.html">Privacy</a>
    <a href="terms.html">Terms</a>
</footer>

<!-- AUTH LOGIC (index-auth.js handles login/signup/reset/change) -->
<script type="module" src="/assets/js/index-auth.js"></script>

<!-- SESSION SYNC FIX -->
<script>
document.addEventListener("DOMContentLoaded", async () => {
    if (typeof supabase === "undefined") return;

    const { data: { session } } = await supabase.auth.getSession();

    if (session?.user) {
        window.currentUser = session.user;
        if (typeof enableGames === "function") enableGames();
    }

    supabase.auth.onAuthStateChange((event, session) => {
        if (session?.user) {
            window.currentUser = session.user;
            if (typeof enableGames === "function") enableGames();
        } else {
            window.currentUser = null;
            if (typeof disableGames === "function") disableGames();
        }
    });
});
</script>

<!-- ENABLE/DISABLE GAME TILES -->
<script>
function enableGames() {
    document.querySelectorAll(".game-card").forEach(c=>c.classList.remove("disabled"));
}
function disableGames() {
    document.querySelectorAll(".game-card").forEach(c=>c.classList.add("disabled"));
}
window.enableGames = enableGames;
window.disableGames = disableGames;
</script>

<!-- MOBILE CAROUSEL SCRIPT -->
<script>
(function() {
    const cards = document.querySelectorAll('.game-card');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const indicatorsContainer = document.getElementById('carouselIndicators');
    let currentIndex = 0;
    let isMobile = window.innerWidth <= 767;

    // Create indicator dots
    function createIndicators() {
        if (!isMobile) return;
        indicatorsContainer.innerHTML = '';
        cards.forEach((_, index) => {
            const dot = document.createElement('div');
            dot.className = 'carousel-dot';
            dot.addEventListener('click', () => goToSlide(index));
            indicatorsContainer.appendChild(dot);
        });
        updateIndicators();
    }

    // Update carousel positions
    function updateCarousel() {
        if (!isMobile) {
            // Desktop: remove carousel classes, add click handlers
            cards.forEach(card => {
                card.classList.remove('active', 'prev', 'next');
                card.onclick = () => location.href = card.dataset.game;
            });
            return;
        }

        // Mobile: carousel mode
        cards.forEach((card, index) => {
            card.classList.remove('active', 'prev', 'next');
            card.onclick = null; // Remove click on non-active cards

            const totalCards = cards.length;
            const position = (index - currentIndex + totalCards) % totalCards;

            if (position === 0) {
                card.classList.add('active');
                // Only active card is clickable
                card.onclick = () => location.href = card.dataset.game;
            } else if (position === 1 || position === totalCards - 1) {
                card.classList.add(position === 1 ? 'next' : 'prev');
            }
        });

        updateIndicators();
    }

    // Update indicator dots
    function updateIndicators() {
        if (!isMobile) return;
        const dots = indicatorsContainer.querySelectorAll('.carousel-dot');
        dots.forEach((dot, index) => {
            dot.classList.toggle('active', index === currentIndex);
        });
    }

    // Navigate to specific slide
    function goToSlide(index) {
        currentIndex = index;
        updateCarousel();
    }

    // Navigate prev/next
    function navigate(direction) {
        const totalCards = cards.length;
        currentIndex = (currentIndex + direction + totalCards) % totalCards;
        updateCarousel();
    }

    // Touch swipe support
    let touchStartX = 0;
    let touchEndX = 0;
    const categoriesContainer = document.getElementById('gameCategories');

    categoriesContainer.addEventListener('touchstart', (e) => {
        if (!isMobile) return;
        touchStartX = e.changedTouches[0].screenX;
    }, { passive: true });

    categoriesContainer.addEventListener('touchend', (e) => {
        if (!isMobile) return;
        touchEndX = e.changedTouches[0].screenX;
        handleSwipe();
    }, { passive: true });

    function handleSwipe() {
        const diff = touchStartX - touchEndX;
        const minSwipeDistance = 50;

        if (Math.abs(diff) > minSwipeDistance) {
            if (diff > 0) {
                navigate(1); // Swipe left - next
            } else {
                navigate(-1); // Swipe right - prev
            }
        }
    }

    // Button listeners
    if (prevBtn) prevBtn.addEventListener('click', () => navigate(-1));
    if (nextBtn) nextBtn.addEventListener('click', () => navigate(1));

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
        if (!isMobile) return;
        if (e.key === 'ArrowLeft') navigate(-1);
        if (e.key === 'ArrowRight') navigate(1);
        if (e.key === 'Enter') {
            const activeCard = document.querySelector('.game-card.active');
            if (activeCard) location.href = activeCard.dataset.game;
        }
    });

    // Handle window resize
    function handleResize() {
        const wasMobile = isMobile;
        isMobile = window.innerWidth <= 767;

        if (wasMobile !== isMobile) {
            if (isMobile) {
                createIndicators();
            } else {
                indicatorsContainer.innerHTML = '';
            }
            updateCarousel();
        }
    }

    window.addEventListener('resize', handleResize);

    // Initialize
    createIndicators();
    updateCarousel();
})();
</script>

<!-- LOAD PLAYERBAR (contains ALL modals now) -->
<script>
async function loadPlayerBar(){
    try {
        const res = await fetch("playerbar.html");
        const html = await res.text();
        const container = document.getElementById("playerbar");
        const temp = document.createElement("div");
        temp.innerHTML = html;

        Array.from(temp.childNodes).forEach(node => {
            if (node.tagName === "SCRIPT") {
                const s = document.createElement("script");
                if (node.src) s.src = node.src;
                else s.textContent = node.textContent;
                document.body.appendChild(s);
            } else {
                container.appendChild(node);
            }
        });
    } catch (e) { console.error(e); }
}
document.addEventListener("DOMContentLoaded", loadPlayerBar);
</script>

</body>
</html>