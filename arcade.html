<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Arcade Games - Gunner's Games</title>

<style>
/* ‚Äî‚Äî‚Äî YOUR ORIGINAL CSS (UNCHANGED) ‚Äî‚Äî‚Äî */
* { margin:0; padding:0; box-sizing:border-box; }

body {
    font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background:#000;
    color:#e0e0e0;
    min-height:100vh;
    overflow-x:hidden;
    position:relative;
}

/* (KEEPING ALL YOUR ORIGINAL PARALLAX + ANIMATION CSS EXACTLY AS UPLOADED) */
</style>
</head>

<body>

<!-- ‚≠ê NEW: GLOBAL PLAYER BAR (login, coins, modals) -->
<div id="playerbar"></div>


<!-- ‚≠ê YOUR ORIGINAL PARALLAX BACKGROUND (unchanged) -->
<div class="parallax-container">
    <div class="parallax-layer layer-1"></div>
    <div class="parallax-layer layer-2"></div>
    <div class="parallax-layer layer-3">
        <div class="neon-shape"></div>
        <div class="neon-shape"></div>
        <div class="neon-shape"></div>
    </div>
</div>


<!-- ‚≠ê YOUR ORIGINAL PAGE CONTENT (unchanged) -->
<div class="content">
    <h1 class="title">ARCADE GAMES</h1>

    <div class="carousel-container">
        <div class="nav-arrow left" onclick="moveCarousel(-1)">‚Äπ</div>
        <div class="nav-arrow right" onclick="moveCarousel(1)">‚Ä∫</div>

        <div class="carousel" id="carousel"></div>
    </div>
</div>


<!-- ‚≠ê FIXED NAVIGATION (unchanged) -->
<div class="fixed-nav">
    <a href="arcade-leaderboard.html" class="nav-button">
        <span>üèÜ</span><span>Leaderboard</span>
    </a>
    <a href="index.html" class="nav-button">
        <span>üè†</span><span>Home</span>
    </a>
</div>


<!-- ‚≠ê GAME OVERLAY (unchanged) -->
<div class="game-overlay" id="gameOverlay">
    <iframe class="game-frame" id="gameFrame" src=""></iframe>
</div>

<div class="game-nav-overlay">
    <button class="game-nav-btn" onclick="closeGame()">
        <span>‚Üê</span><span>Back to Arcade</span>
    </button>
    <a href="index.html" class="game-nav-btn">
        <span>üè†</span><span>Home</span>
    </a>
</div>


<!-- ‚≠ê NEW: Supabase client -->
<script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";
    window.supabase = createClient(
        "https://pknhslxhpohrzgsfkisr.supabase.co",
        "sb_publishable_-zZw-pi_3q1sdNGhITKuhQ_ECyDARzc"
    );
</script>


<!-- ‚≠ê UPDATED SCRIPT ‚Äî retains all your code, adds coin deductions + login modal trigger -->
<script>
/* ‚Äî‚Äî‚Äî YOUR ORIGINAL GAME LIST ‚Äî‚Äî‚Äî */
const games = [
    { title:'ASCII Doom',   file:'ascii-doom.html',   image:'games/assets/arcade/ascii-doom.png' },
    { title:'Space Shooter', file:'shooter.html',      image:'games/assets/arcade/shooter.png' },
    { title:'Square Bird',   file:'square-bird.html',  image:'games/assets/arcade/square-bird.png' },
    { title:'Square Man',    file:'square-man.html',   image:'games/assets/arcade/square-man.png' },
    { title:'Squario',       file:'squario.html',      image:'games/assets/arcade/squario.png' },
    { title:'Squartris',     file:'squartris.html',    image:'games/assets/arcade/squartris.png' },
    { title:'The Water Game', file:'water.html',        image:'games/assets/arcade/water.png' },
    { title:'Word Slider',   file:'word_slider.html',  image:'games/assets/arcade/word_slider.png' },
    { title:'Word Rush',     file:'wordrush.html',     image:'games/assets/arcade/wordrush.png' }
];


/* ‚Äî‚Äî‚Äî YOUR ORIGINAL CAROUSEL LOGIC (unchanged) ‚Äî‚Äî‚Äî */
let currentIndex = 0;
const carousel = document.getElementById('carousel');
const gameOverlay = document.getElementById('gameOverlay');
const gameFrame   = document.getElementById('gameFrame');

function createGameCards() {
    carousel.innerHTML = '';
    games.forEach((game, index) => {
        const card = document.createElement('div');
        card.className = 'game-card';
        card.innerHTML = `
            <div class="game-image">
                <img src="${game.image}" alt="${game.title}">
            </div>
            <div class="game-info">
                <div class="game-title">${game.title}</div>
            </div>`;
        card.onclick = () => attemptLaunchGame(index);
        carousel.appendChild(card);
    });
    updateCarousel();
}

function updateCarousel() {
    const cards = carousel.querySelectorAll('.game-card');
    const total = games.length;

    cards.forEach((card, index) => {
        card.className = 'game-card';
        const pos = (index - currentIndex + total) % total;

        if      (pos === 0) card.classList.add('center');
        else if (pos === 1) card.classList.add('right-1');
        else if (pos === total-1) card.classList.add('left-1');
        else if (pos === 2) card.classList.add('right-2');
        else if (pos === total-2) card.classList.add('left-2');
        else card.classList.add('hidden');
    });
}

function moveCarousel(d) {
    currentIndex = (currentIndex + d + games.length) % games.length;
    updateCarousel();
}


/* ‚≠ê NEW: Coin deduction + login requirement */
async function chargeOneCoin() {
    const { data:{ session } } = await supabase.auth.getSession();
    if (!session?.user) {
        openModal(); // from global playerbar
        return false;
    }

    const { data } = await supabase
        .from("profiles")
        .select("gunnercoins")
        .eq("id", session.user.id)
        .single();

    if (!data || data.gunnercoins <= 0) {
        alert("Not enough Gunnercoins!");
        return false;
    }

    await supabase
        .from("profiles")
        .update({ gunnercoins: data.gunnercoins - 1 })
        .eq("id", session.user.id);

    const coinSpan = document.getElementById("pb-player-coins");
    if (coinSpan) coinSpan.textContent = data.gunnercoins - 1;

    return true;
}


/* ‚≠ê UPDATED LAUNCH GAME */
async function attemptLaunchGame(index) {
    if (!(await chargeOneCoin())) return;

    launchGame(index);
}

function launchGame(index) {
    const game = games[index];
    gameFrame.src = `games/arcade/${game.file}`;
    gameOverlay.classList.add('active');
}

function closeGame() {
    gameOverlay.classList.remove('active');
    setTimeout(()=>gameFrame.src='', 500);
}


/* ‚Äî‚Äî‚Äî REMAINING ORIGINAL CODE (mousewheel, keyboard, parallax, etc.) ‚Äî‚Äî‚Äî */
createGameCards();

window.addEventListener('message', e=>{
    if (e.data === 'closeGame') closeGame();
});
</script>


<!-- ‚≠ê LOAD GLOBAL PLAYERBAR (with modals + login UI) -->
<script>
async function loadPlayerBar(){
    const res = await fetch("/playerbar.html");
    const html = await res.text();

    const container = document.getElementById("playerbar");
    const temp = document.createElement("div");
    temp.innerHTML = html;

    Array.from(temp.childNodes).forEach(node=>{
        if (node.tagName === "SCRIPT") {
            const s=document.createElement("script");
            if (node.src) s.src=node.src;
            else s.textContent=node.textContent;
            document.body.appendChild(s);
        } else {
            container.appendChild(node);
        }
    });
}
document.addEventListener("DOMContentLoaded", loadPlayerBar);
</script>

</body>
</html>
