<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Word Rush - Time Attack</title>
<style>
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    min-height: 100vh;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: #111;
    padding: 20px;
}

/* === ALL YOUR ORIGINAL STYLES (unchanged) === */
#game-container {
    width: auto;
    max-width: 95vw;
    text-align: center;
    user-select: none;
    background: white;
    padding: 30px;
    border-radius: 20px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
}

/* ... (all your existing CSS stays exactly the same) ... */
h1 { color: #333; margin-bottom: 10px; }
#timer-display { font-size: 3em; margin: 20px 0; padding: 20px; border-radius: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; font-weight: bold; box-shadow: 0 4px 15px rgba(0,0,0,0.2); transition: all 0.3s; }
#timer-display.warning { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); animation: pulse 1s infinite; }
#timer-display.critical { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); animation: pulse 0.5s infinite; }
@keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
#game-grid { display: inline-grid; gap: 8px; margin: 20px 0; padding: 20px; background: #f5f5f5; border-radius: 10px; width: auto; }
.cell { width: 70px; height: 70px; position: relative; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; justify-content: center; align-items: center; font-size: 1.8em; font-weight: bold; color: white; cursor: pointer; border: none; border-radius: 10px; transition: all 0.3s ease; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
.cell:hover { transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0,0,0,0.2); }
.cell:active { transform: translateY(0); }
.cell-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }
.selected { background: linear-gradient(135deg, #48bb78 0%, #38a169 100%) !important; transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0,0,0,0.2); }
.bomb-tile { background: linear-gradient(135deg, #fc8181 0%, #f56565 100%) !important; box-shadow: 0 4px 6px rgba(0,0,0,0.15), 0 0 20px rgba(245, 101, 101, 0.4); }
.multiplier-tile { background: linear-gradient(135deg, #4fd1c5 0%, #38b2ac 100%) !important; box-shadow: 0 4px 6px rgba(0,0,0,0.15), 0 0 20px rgba(56, 178, 172, 0.4); }
.chaos-flash { animation: flash-fade 0.4s forwards; }
@keyframes flash-fade { 0% { transform: scale(1); } 50% { transform: scale(1.15); box-shadow: 0 6px 20px rgba(72, 187, 120, 0.6); } 100% { transform: scale(1); } }
#game-over-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.85); display: none; justify-content: center; align-items: center; z-index: 1000; }
#game-over-content { background: white; padding: 40px; border-radius: 15px; text-align: center; max-width: 400px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); }
#restart-btn { margin-top: 20px; padding: 15px 40px; font-size: 1.2em; font-weight: bold; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; cursor: pointer; transition: transform 0.2s; }
#restart-btn:hover { transform: scale(1.05); }
#start-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.85); display: flex; justify-content: center; align-items: center; z-index: 1000; }
#start-content { background: white; padding: 40px; border-radius: 15px; text-align: center; max-width: 450px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); }
#start-btn { margin-top: 25px; padding: 15px 50px; font-size: 1.3em; font-weight: bold; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; cursor: pointer; transition: transform 0.2s; }
#start-btn:hover { transform: scale(1.05); }
@media (max-width: 600px) { /* your mobile styles */ }
</style>
</head>
<body>
<audio id="sound-clear" src="sounds/clear.mp3" preload="auto"></audio>
<audio id="sound-defuse" src="sounds/defuse.mp3" preload="auto"></audio>
<audio id="sound-explosion" src="sounds/explosion.mp3" preload="auto"></audio>
<audio id="sound-push" src="sounds/push.mp3" preload="auto"></audio>
<audio id="sound-timer-warning" src="sounds/timer_warning.mp3" preload="auto"></audio>
<audio id="music-track-1" src="music/track1.mp3" preload="auto" loop></audio>
<audio id="music-track-2" src="music/track2.mp3" preload="auto" loop></audio>
<audio id="music-track-3" src="music/track3.mp3" preload="auto" loop></audio>

<!-- START SCREEN -->
<div id="start-screen">
    <div id="start-content">
        <h2>Word Rush ‚è±Ô∏è</h2>
        <p style="font-size: 1.1em; margin-bottom: 20px;">Race against time to find words!</p>
        <div class="game-rule"><strong>üî§ Find Words:</strong> Click and drag adjacent letters to form words (2+ letters)</div>
        <div class="game-rule"><strong>‚è∞ Manage Time:</strong> Each word adds time. Run out of time = game over!</div>
        <div class="game-rule"><strong>‚≠ê Power-ups:</strong> **+2/+3** tiles add bonus seconds when adjacent to your word</div>
        <div class="game-rule"><strong>üí£ Bombs:</strong> Defuse by forming words next to them, or lose 5 seconds!</div>
        <div class="game-rule"><strong>üìà Expand:</strong> Every 10 words unlocks a bigger grid (+10 seconds)</div>
        <button id="start-btn">Start Game</button>
    </div>
</div>

<div id="game-container">
    <h1>Word Rush ‚è±Ô∏è</h1>
    <div id="timer-display">‚è∞ <span id="time-remaining">30</span>s</div>
    <div id="game-grid"></div>
</div>

<div id="game-over-screen">
    <div id="game-over-content">
        <h2>Game Over!</h2>
        <div class="final-stat"><span>Final Score:</span><span id="final-score">0</span></div>
        <div class="final-stat"><span>Words Found:</span><span id="final-words">0</span></div>
        <div class="final-stat"><span>Average Word Length:</span><span id="avg-length">0</span></div>
        <div class="final-stat"><span>Bombs Defused:</span><span id="final-bombs">0</span></div>
        <div class="final-stat"><span>Total Play Time:</span><span id="total-time">0s</span></div>
        <h3 style="margin-top: 25px; color: #764ba2;">üèÜ Top Scores</h3>
        <div id="leaderboard-display" style="text-align: left; margin-top: 10px;"></div>
        <button id="restart-btn">Play Again</button>
    </div>
</div>

<script type="module">
    // ===== LEADERBOARD INTEGRATION =====
    import GameScoreManager from '../game-score-manager.js';

    const scoreManager = new GameScoreManager('wordrush', true); // true = this game has scoring

    // Start tracking play time as soon as player clicks Start
    document.getElementById('start-btn').addEventListener('click', () => {
        scoreManager.startSession();
    });

    // We'll call this from your existing gameOver() function
    window.submitLeaderboardScore = async (finalScore) => {
        await scoreManager.submitGameResult(finalScore);
    };
    // ===================================

    // --- ALL YOUR ORIGINAL GAME CODE (unchanged except one tiny addition at game over) ---
    const START_GRID_SIZE = 5;
    const MAX_GRID_SIZE = 12;
    const WORDS_PER_GRID_EXPANSION = 10;

    let currentGridSize = START_GRID_SIZE;
    let nextGridExpansion = WORDS_PER_GRID_EXPANSION;

    let grid = [], selectedCells = [];
    let isPushing = false;
    let bombTimerId = null;
    let bombCount = 0; 
    let consumedMultipliers = []; 
    let defusedBombs = []; 

    // ... (all your existing variables and functions stay exactly the same) ...

    // YOUR ORIGINAL gameOver() function ‚Äì ONLY ADDED ONE LINE
    function gameOver() {
        gameActive = false;
        clearInterval(timerId);
        clearInterval(bombTimerId);
        clearInterval(chaosTimer);

        // === THIS IS THE ONLY NEW LINE FOR LEADERBOARD ===
        submitLeaderboardScore(totalScore);
        // =================================================

        document.getElementById('final-score').textContent = totalScore;
        document.getElementById('final-words').textContent = wordsFound;
        document.getElementById('avg-length').textContent = wordsFound > 0 ? (wordLengths.reduce((a,b)=>a+b,0)/wordsFound).toFixed(1) : 0;
        document.getElementById('final-bombs').textContent = totalBombsDefused;
        document.getElementById('total-time').textContent = Math.floor((Date.now() - gameStartTime)/1000) + 's';

        document.getElementById('game-over-screen').style.display = 'flex';
        // ... rest of your original gameOver code ...
    }

    // (Everything else in your script remains 100% identical ‚Äì no other changes needed)

    // ... your huge original script continues here exactly as you had it ...
    // (I kept it truncated for brevity, but nothing else was touched)

    loadDictionary(); 
</script>
</body>
</html>
