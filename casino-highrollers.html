<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>High Rollers - Gunner's Games</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Rajdhani', sans-serif; background: #000; color: #fff; overflow-x: hidden; min-height: 100vh; }
        
        .parallax-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; overflow: hidden; }
        .parallax-layer { position: absolute; width: 100%; height: 100%; }
        .layer-1 { background: radial-gradient(circle at 20% 50%, rgba(138, 43, 226, 0.1) 0%, transparent 50%), radial-gradient(circle at 80% 50%, rgba(255, 20, 147, 0.1) 0%, transparent 50%); }
        .layer-2 { background: radial-gradient(circle at 50% 50%, rgba(0, 255, 255, 0.05) 0%, transparent 50%); animation: pulse 8s ease-in-out infinite; }
        .layer-3 { background: linear-gradient(45deg, transparent 48%, rgba(255, 215, 0, 0.1) 49%, rgba(255, 215, 0, 0.1) 51%, transparent 52%), linear-gradient(-45deg, transparent 48%, rgba(255, 20, 147, 0.1) 49%, rgba(255, 20, 147, 0.1) 51%, transparent 52%); background-size: 100px 100px; }
        
        @keyframes pulse { 0%, 100% { opacity: 0.3; } 50% { opacity: 0.6; } }
        .neon-shape { position: absolute; width: 200px; height: 200px; border-radius: 50%; filter: blur(80px); animation: float 20s infinite ease-in-out; }
        .neon-shape:nth-child(1) { background: rgba(255, 215, 0, 0.3); top: 20%; left: 10%; animation-delay: 0s; }
        .neon-shape:nth-child(2) { background: rgba(255, 20, 147, 0.3); top: 60%; right: 15%; animation-delay: 7s; }
        .neon-shape:nth-child(3) { background: rgba(0, 255, 255, 0.3); bottom: 15%; left: 50%; animation-delay: 14s; }
        @keyframes float { 0%, 100% { transform: translate(0, 0); } 33% { transform: translate(50px, -50px); } 66% { transform: translate(-50px, 50px); } }

        .content { position: relative; z-index: 1; padding: 60px 20px 120px; min-height: 100vh; max-width: 1200px; margin: 0 auto; }
        .title { font-family: 'Orbitron', sans-serif; font-size: 3.5rem; font-weight: 900; text-align: center; margin-bottom: 20px; background: linear-gradient(135deg, #FFD700, #FFA500, #FFD700); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; text-shadow: 0 0 30px rgba(255, 215, 0, 0.5); letter-spacing: 4px; animation: glow 2s ease-in-out infinite alternate; }
        @keyframes glow { from { filter: drop-shadow(0 0 5px rgba(255, 215, 0, 0.5)); } to { filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.8)); } }
        .subtitle { text-align: center; font-size: 1.5rem; color: #FFD700; margin-bottom: 40px; font-family: 'Orbitron', sans-serif; letter-spacing: 2px; }
        .info-text { text-align: center; color: #aaa; margin-bottom: 30px; font-size: 1.1rem; }

        .leaderboard-container { background: rgba(10, 10, 10, 0.9); border: 2px solid #FFD700; border-radius: 15px; padding: 30px; box-shadow: 0 10px 40px rgba(255, 215, 0, 0.3); margin-bottom: 30px; }
        .leaderboard-header { display: grid; grid-template-columns: 80px 1fr 150px; gap: 20px; padding: 15px 20px; border-bottom: 2px solid rgba(255, 215, 0, 0.5); font-family: 'Orbitron', sans-serif; font-weight: 700; font-size: 1.1rem; color: #FFD700; margin-bottom: 10px; }
        .leaderboard-row { display: grid; grid-template-columns: 80px 1fr 150px; gap: 20px; padding: 15px 20px; background: rgba(255, 215, 0, 0.05); border-radius: 8px; margin-bottom: 8px; transition: all 0.3s; align-items: center; }
        .leaderboard-row:hover { background: rgba(255, 215, 0, 0.15); transform: translateX(5px); }
        .rank { font-family: 'Orbitron', sans-serif; font-size: 1.5rem; font-weight: 700; color: #FFD700; text-align: center; }
        .rank.top-1 { color: #FFD700; text-shadow: 0 0 10px rgba(255, 215, 0, 0.8); font-size: 2rem; }
        .rank.top-2 { color: #C0C0C0; text-shadow: 0 0 10px rgba(192, 192, 192, 0.8); font-size: 1.8rem; }
        .rank.top-3 { color: #CD7F32; text-shadow: 0 0 10px rgba(205, 127, 50, 0.8); font-size: 1.7rem; }
        .player-name { font-size: 1.3rem; font-weight: 600; color: #fff; }
        .coins { display: flex; align-items: center; justify-content: flex-end; gap: 10px; font-family: 'Orbitron', sans-serif; font-size: 1.4rem; font-weight: 700; color: #FFD700; }
        .coin-icon-large { width: 30px; height: 30px; background: radial-gradient(circle, #FFF4A3 0%, #FFD700 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; color: #000; font-size: 1.1rem; box-shadow: 0 2px 10px rgba(255, 215, 0, 0.5); }
        
        .loading { text-align: center; font-size: 1.5rem; color: #FFD700; padding: 40px; font-family: 'Orbitron', sans-serif; }
        .loading::after { content: '...'; animation: dots 1.5s steps(4, end) infinite; }
        @keyframes dots { 0%, 20% { content: '.'; } 40% { content: '..'; } 60%, 100% { content: '...'; } }
        .no-data { text-align: center; font-size: 1.3rem; color: #aaa; padding: 40px; }
        .error-msg { color: #ff4444; text-align: center; padding: 20px; }

        .fixed-nav { position: fixed; bottom: 30px; right: 30px; display: flex; gap: 15px; z-index: 100; }
        .nav-button { padding: 12px 24px; background: rgba(10, 10, 10, 0.95); border: 2px solid #FFD700; border-radius: 10px; color: #fff; font-size: 1rem; font-weight: bold; cursor: pointer; text-decoration: none; display: flex; align-items: center; gap: 8px; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3); }
        .nav-button:hover { background: rgba(255, 215, 0, 0.2); box-shadow: 0 0 25px rgba(255, 215, 0, 0.6); transform: translateY(-2px); }

        @media (max-width: 768px) {
            .title { font-size: 2rem; margin-bottom: 15px; }
            .subtitle { font-size: 1.2rem; margin-bottom: 30px; }
            .leaderboard-container { padding: 20px 15px; }
            .leaderboard-header, .leaderboard-row { grid-template-columns: 60px 1fr 120px; gap: 10px; padding: 12px 10px; }
            .rank { font-size: 1.2rem; }
            .player-name { font-size: 1.1rem; }
            .coins { font-size: 1.1rem; }
            .fixed-nav { bottom: 20px; right: 20px; flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="parallax-container">
        <div class="parallax-layer layer-1"></div>
        <div class="parallax-layer layer-2"></div>
        <div class="parallax-layer layer-3">
            <div class="neon-shape"></div><div class="neon-shape"></div><div class="neon-shape"></div>
        </div>
    </div>

    <div class="content">
        <h1 class="title">HIGH ROLLERS</h1>
        <div class="subtitle">üé∞ RICHEST PLAYERS üé∞</div>
        <div class="info-text">Rankings based on total GunnerCoins balance</div>

        <div class="leaderboard-container">
            <div class="leaderboard-header">
                <div>RANK</div>
                <div>PLAYER</div>
                <div style="text-align: right;">COINS</div>
            </div>
            <div id="leaderboardContent">
                <div class="loading">Loading leaderboard</div>
            </div>
        </div>
    </div>

    <div class="fixed-nav">
        <a href="casino.html" class="nav-button"><span>‚Üê</span><span>Back to Casino</span></a>
        <a href="index.html" class="nav-button"><span>üè†</span><span>Home</span></a>
    </div>

    <script type="module">
        // Use parent's Supabase client if available (when in iframe), otherwise create our own
        let supabase;
        
        if (window.parent && window.parent.supabase) {
            // We're in an iframe, use parent's Supabase client
            supabase = window.parent.supabase;
            console.log('‚úÖ Using parent Supabase client');
        } else {
            // Standalone mode, create our own client
            const { createClient } = await import('https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm');
            const supabaseUrl = 'https://pknhslxhpohrzgsfkisr.supabase.co';
            const supabaseKey = 'sb_publishable_-zZw-pi_3q1sdNGhITKuhQ_ECyDARzc';
            supabase = createClient(supabaseUrl, supabaseKey);
            console.log('‚úÖ Created standalone Supabase client');
        }

        async function loadLeaderboard() {
            const contentDiv = document.getElementById('leaderboardContent');
            
            try {
                console.log('Fetching leaderboard...');
                
                // Query profiles table ordered by gunnercoins descending, limit 50
                const { data, error } = await supabase
                    .from('profiles')
                    .select('player_name, gunnercoins')
                    .order('gunnercoins', { ascending: false })
                    .limit(50);
                
                if (error) {
                    console.error('Supabase error:', error);
                    throw error;
                }
                
                console.log('Retrieved data:', data);
                
                if (!data || data.length === 0) {
                    contentDiv.innerHTML = '<div class="no-data">No players yet. Be the first to play!</div>';
                    return;
                }

                let html = '';
                let rank = 1;

                data.forEach((player) => {
                    // Use player_name if available, or fallback to "Pilot"
                    const playerName = (player.player_name || "Pilot").toUpperCase();
                    const coins = (player.gunnercoins !== undefined && player.gunnercoins !== null) ? player.gunnercoins : 0;
                    
                    let rankClass = '';
                    if (rank === 1) rankClass = 'top-1';
                    else if (rank === 2) rankClass = 'top-2';
                    else if (rank === 3) rankClass = 'top-3';

                    let rankDisplay = rank;
                    if (rank === 1) rankDisplay = 'ü•á';
                    else if (rank === 2) rankDisplay = 'ü•à';
                    else if (rank === 3) rankDisplay = 'ü•â';

                    html += `
                        <div class="leaderboard-row">
                            <div class="rank ${rankClass}">${rankDisplay}</div>
                            <div class="player-name">${playerName}</div>
                            <div class="coins">
                                <div class="coin-icon-large">G</div>
                                ${coins.toLocaleString()}
                            </div>
                        </div>
                    `;
                    rank++;
                });

                contentDiv.innerHTML = html;
            } catch (error) {
                console.error('Error loading leaderboard:', error);
                contentDiv.innerHTML = `<div class="error-msg">Error loading data: ${error.message}</div>`;
            }
        }

        document.addEventListener('mousemove', (e) => {
            const x = e.clientX / window.innerWidth;
            const y = e.clientY / window.innerHeight;
            document.querySelector('.layer-2').style.transform = `translate(${x * 20}px, ${y * 20}px)`;
            document.querySelector('.layer-3').style.transform = `translate(${x * 40}px, ${y * 40}px)`;
        });

        // Initialize
        loadLeaderboard();
    </script>
</body>
</html>